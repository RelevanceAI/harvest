{
  "entities": [
    {
      "name": "HarvestSession",
      "entityType": "session_context",
      "observations": [
        "Running in Modal sandbox with persistent volumes",
        "Workspace at /workspace/{repo-name}",
        "Config files at /app/ (read-only, baked into image)",
        "Memory persists at /root/.mcp-memory/memory.jsonl",
        "Session spins up per task, shuts down after completion",
        "Only committed and pushed work persists across sessions"
      ]
    },
    {
      "name": "EnvironmentConfig",
      "entityType": "environment_knowledge",
      "observations": [
        "Node.js 22 available via NodeSource, Volta for version switching",
        "pnpm available globally for monorepo package management",
        "Chromium available via Playwright for browser automation",
        "GitHub CLI (gh) available for repo operations",
        "Git configured with user from GITHUB_TOKEN",
        "MCP servers: memory, filesystem, playwright, devtools (always)",
        "MCP servers: github, gemini, sentry, linear (when API keys provided)",
        "No interactive editors (vim/nano) - use non-interactive git commands",
        "DISPLAY=:99 for headless browser automation"
      ]
    },
    {
      "name": "GitWorkflow",
      "entityType": "process_knowledge",
      "observations": [
        "CRITICAL: Never use git pull or git stash - commits are permanent, stash can be lost",
        "Safe-Carry-Forward: snapshot -> fetch -> rebase (always in this order)",
        "Snapshot command: git add -A && git commit -m 'wip: snapshot' --no-verify",
        "Checkpoint before risky ops: git checkout -b checkpoint-$BRANCH-$(date +%s)",
        "Squash before final push: git reset --soft origin/<branch> && git commit",
        "Force-push allowed ONLY if sole contributor to branch",
        "Branch ownership check: count unique authors in git log",
        "Never --no-verify on real commits, only WIP snapshots",
        "Max 3 attempts on any error before Panic Button"
      ]
    },
    {
      "name": "WorkflowProcedures",
      "entityType": "process_knowledge",
      "observations": [
        "Session start: Query memory for ErrorPatterns and LearnedPatterns",
        "Before implementing: Research codebase, find existing patterns",
        "Complex changes: Use Gemini for adversarial plan review",
        "After fixing error: ALWAYS update ErrorPatterns entity",
        "After learning pattern: Update LearnedPatterns entity",
        "Before push: Run full test suite, squash WIP commits",
        "PR conventions: Clear title, description with context, link Linear if applicable",
        "Session end: Delete checkpoint branches, post status to Slack"
      ]
    },
    {
      "name": "ErrorPatterns",
      "entityType": "incident_knowledge",
      "observations": [
        "Module not found: Check package.json, run npm/pnpm install, verify import paths",
        "Permission denied: Check file ownership, directory permissions",
        "Git conflict: Create checkpoint first, resolve all markers, run tests",
        "Test timeout: Increase timeout, check for infinite loops, verify async handling",
        "Browser launch failed: Ensure DISPLAY=:99, check Chromium installation"
      ]
    },
    {
      "name": "LearnedPatterns",
      "entityType": "codebase_knowledge",
      "observations": [
        "Initial seed - update this entity as you discover repo-specific patterns",
        "Check existing code for conventions before implementing new features",
        "Follow test naming conventions found in existing test files"
      ]
    },
    {
      "name": "ComplexityDecisions",
      "entityType": "execution_knowledge",
      "observations": [
        "Track brainstorming decisions and outcomes",
        "Format: [DATE] Task 'description' → [brainstormed/skipped] → [outcome] → [GOOD CALL/SHOULD HAVE X]"
      ]
    },
    {
      "name": "VerificationPatterns",
      "entityType": "execution_knowledge",
      "observations": [
        "Track verification approaches per file type",
        "Format: [file pattern] changes → [verification approach] → [worked/revealed issues]",
        "Example: src/api/*.ts → Integration tests required → Caught auth bug"
      ]
    },
    {
      "name": "SuccessfulWorkflows",
      "entityType": "execution_knowledge",
      "observations": [
        "Track end-to-end successful task completions",
        "Format: [Context] Task 'description' → [workflow steps] → PR merged [DATE]"
      ]
    },
    {
      "name": "FailurePatterns",
      "entityType": "execution_knowledge",
      "observations": [
        "Track panic situations and resolutions",
        "Format: [DATE] PANIC/RESOLVED: [error type] → [root cause] → [fix] → [outcome]",
        "Use for learning to avoid repeated failures"
      ]
    },
    {
      "name": "SessionProgress",
      "entityType": "session_state",
      "observations": [
        "Track attempts during current session for loop detection",
        "Format: Attempt [N]: [action] (files changed: [count]) → [result]",
        "Cleared after circuit breaker or session end",
        "Used by simple loop detector (v1)"
      ]
    },
    {
      "name": "LoopDetectionFailures",
      "entityType": "improvement_tracking",
      "observations": [
        "Track when simple loop detection fails",
        "Format: [DATE] Simple detection [missed loop/blocked valid retry]: [scenario] → Suggests [improvement needed]",
        "Review periodically to prioritize iteration path",
        "Examples: Environment change false positive → Add cache tracking"
      ]
    }
  ],
  "relations": [
    {
      "from": "HarvestSession",
      "to": "EnvironmentConfig",
      "relationType": "runs_in"
    },
    {
      "from": "HarvestSession",
      "to": "GitWorkflow",
      "relationType": "follows"
    },
    {
      "from": "GitWorkflow",
      "to": "WorkflowProcedures",
      "relationType": "part_of"
    },
    {
      "from": "ErrorPatterns",
      "to": "EnvironmentConfig",
      "relationType": "informs"
    },
    {
      "from": "LearnedPatterns",
      "to": "WorkflowProcedures",
      "relationType": "informs"
    },
    {
      "from": "ComplexityDecisions",
      "to": "SuccessfulWorkflows",
      "relationType": "informs"
    },
    {
      "from": "VerificationPatterns",
      "to": "SuccessfulWorkflows",
      "relationType": "validates"
    },
    {
      "from": "FailurePatterns",
      "to": "ErrorPatterns",
      "relationType": "prevents"
    },
    {
      "from": "HarvestSession",
      "to": "ComplexityDecisions",
      "relationType": "uses"
    },
    {
      "from": "HarvestSession",
      "to": "VerificationPatterns",
      "relationType": "uses"
    },
    {
      "from": "SessionProgress",
      "to": "FailurePatterns",
      "relationType": "enables"
    },
    {
      "from": "LoopDetectionFailures",
      "to": "SessionProgress",
      "relationType": "improves"
    },
    {
      "from": "HarvestSession",
      "to": "SessionProgress",
      "relationType": "tracks_in"
    }
  ]
}
